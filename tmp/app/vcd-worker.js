!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";const updateIdTable=($,link)=>{if(void 0!==$.ido[link])return $.ido[link][0];let hash=0,poly=1;for(let i=0;i<link.length;i++){hash=hash+poly*(link.charCodeAt(i)-33+1)&4095,poly=97*poly&4095}const newId=$.nextId;return $.ido[link]=[newId,hash],void 0===$.hashTable[hash]&&($.hashTable[hash]={}),$.hashTable[hash][link]=newId,$.nextId+=1,newId};module.exports=($,cmd,str)=>{switch(str=str.trim(),cmd){case 1:$.comment=str;break;case 2:$.date=str;break;case 3:((info,str)=>{const[type,name]=str.split(/\s+/),ero={kind:"scope",type:type,name:name,body:[]};info.stack[info.stack.length-1].body.push(ero),info.stack.push(ero)})($,str);break;case 4:$.timescale=str;break;case 5:$.stack.pop();break;case 6:(($,str)=>{const eroj=str.split(/\s+/),link=eroj[2],ero={kind:"var",type:eroj[0],size:parseInt(eroj[1]),link:link,name:eroj.slice(3).join(""),id:updateIdTable($,link)};{const m=ero.name.match("^(?<name>\\w+)\\["+(ero.size-1)+":0]$");m&&(ero.name=m.groups.name)}$.stack[$.stack.length-1].body.push(ero)})($,str);break;case 7:$.version=str;break;default:console.log([cmd,str])}}},{}],2:[function(require,module,exports){"use strict";const memmap=require("./memmap.js"),commandHandler=require("./command-handler.js"),align=(val,ali)=>val+(ali-1)&-ali;module.exports=()=>{const $={wires:{kind:"scope",type:".",name:".",body:[]},hashTable:[],ido:{},nextId:1};return $.stack=[$.wires],$.getString=p=>{let endp=p+100;for(let i=p;i<endp;i++)if(0===$.memU8[i]){endp=i;break}return(new TextDecoder).decode($.memU8.slice(p,endp))},$.genOnCommand=(command,p)=>{commandHandler($,command,$.getString(p))},$.endDefinitions=()=>{const{hashTable:hashTable}=$,hashArray=Array.from({length:hashTable.length});let top=hashTable.length;for(let i=0;i<hashTable.length;i++){const elo=hashTable[i];if(void 0===elo)hashArray[i]=0;else{const keys=Object.keys(elo).sort();if(0===keys.length)throw new Error("strange empty object");if(1===keys.length)hashArray[i]=elo[keys[0]];else{hashArray[i]=-top;for(let j=0;j<keys.length-1;j++){const key=keys[j],clen=align(key.length,4),keyArr8=(new TextEncoder).encode(key),keyArr8A=new Uint8Array(clen);keyArr8A.set(keyArr8);const keyArr32=new Uint32Array(keyArr8A.buffer);top+=2+clen/4,hashArray.push(elo[key]),j===keys.length-2?hashArray.push(elo[keys[j+1]]):hashArray.push(-top);for(const e of keyArr32)hashArray.push(e)}}}}console.log(hashArray),$.hashArray=Int32Array.from(hashArray),console.log($.hashArray),$.memI32.set($.hashArray,memmap.definitions/4),$.memI32[memmap.num_ids]=$.nextId;const output_idx_addr=align(memmap.definitions+4*$.hashArray.length,32);$.memI32[memmap.output_idx_ptr]=output_idx_addr;const free_page_addr=align(output_idx_addr+16*$.nextId,65536);$.memI32[memmap.free_page_ptr]=free_page_addr,console.log("$enddefinitions",$),postMessage({cmd:"enddefinitions",data:{wires:$.wires,timescale:$.timescale}})},$}},{"./command-handler.js":1,"./memmap.js":4}],3:[function(require,module,exports){"use strict";module.exports=async($,fileName)=>await WebAssembly.instantiateStreaming(fetch(fileName),{env:{abort:()=>{console.error("Abort!")},consoleLog:val=>{console.log(val)},endDefinitions:$.endDefinitions,onCommand:$.genOnCommand,onTimeStamp:()=>{console.log("#",$.memU32.slice(8,10))},onIdString:(p,id,cmd,v,vlen,m,mlen)=>{console.log({id:id,sId:$.getString(p),cmd:cmd,v:$.memU64[v/8].toString(16),vlen:vlen,m:$.memU64[m/8].toString(16),mlen:mlen})},memory:new WebAssembly.Memory({initial:1e4,maximum:65536,shared:!0})}})},{}],4:[function(require,module,exports){"use strict";module.exports={context:0,t0:4,time:5,definitions_ptr:12,output_idx_ptr:13,free_page_ptr:14,num_ids:15,input:65536,definitions:67174400}},{}],5:[function(require,module,exports){"use strict";const memmap=require("./memmap.js");module.exports=async($,dataFileName)=>{const{init:init,chunk:chunk}=$.wasmInstance.exports,contextLength=init(memmap.context);if(contextLength>65536)throw console.error("VERY LAGE CONTEXT:",contextLength),new Error;$.memU32[memmap.definitions_ptr]=memmap.definitions;const reader=(await fetch(dataFileName,{headers:{"Accept-Encoding":"br, deflate"}})).body.getReader(),stats={numChunks:0,maxLength:0,totalLength:0};for(let i=0;i<1e4;i++){const{value:value,done:done}=await reader.read();if(done)break;if($.memU8.set(value,memmap.input),value.length>67108864)throw console.error("VERY LAGE CHUNK:",value.length),new Error;const error=chunk(memmap.context,memmap.input,memmap.input+value.length);if(error)throw new Error(error);stats.maxLength=Math.max(stats.maxLength,value.length),stats.totalLength+=value.length,stats.numChunks++,postMessage({cmd:"stats",data:stats})}return console.log(stats),stats}},{"./memmap.js":4}],6:[function(require,module,exports){"use strict";const loadWasm=require("./load-wasm.js"),initVcdWorkerState=require("./init-vcd-worker-state.js"),streamData=require("./stream-data.js");(async()=>{const t0=Date.now(),$=initVcdWorkerState(),handlers={loadWasm:async()=>{console.log("Loading Wasm"),$.wasmInstance=(await loadWasm($,"vcd.wasm")).instance;const mem=$.wasmInstance.exports.memory;$.memU8=new Uint8Array(mem.buffer),$.memU32=new Uint32Array(mem.buffer),$.memI32=new Int32Array(mem.buffer),$.memU64=new BigUint64Array(mem.buffer),$.memI64=new BigInt64Array(mem.buffer),postMessage({cmd:"wasmMemory",data:mem})},loadVcd:async e=>{const t1=Date.now(),stats=await streamData($,e.data.data),t2=Date.now();stats.tStream=t2-t1,stats.tLoad=t1-t0,stats[0]=1e3*stats.totalLength/stats.tStream,console.log(stats),postMessage({cmd:"loadVcdDone"})}};onmessage=async e=>{"object"==typeof e.data&&null!==e.data&&"Object"===e.data.constructor.name||console.log("UNKNOWN MSG",e);const handler=handlers[e.data.cmd]||(async()=>{console.log("UNKNOWN CMD",e.data)});await handler(e)}})()},{"./init-vcd-worker-state.js":2,"./load-wasm.js":3,"./stream-data.js":5}]},{},[6]);